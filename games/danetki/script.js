const DB = [
    // --- Твой исходный набор ---
    { q: "Человек заходит в бар и просит воды. Бармен достает пистолет. Человек говорит 'спасибо' и уходит.", a: "У него была икота. Бармен напугал его, и икота прошла." },
    { q: "Двое подошли к реке. У берега лодка на одного. Оба переправились.", a: "Они стояли на разных берегах реки и шли навстречу друг другу." },
    { q: "Лежит мертвый человек в пустыне со сломанной спичкой в руке.", a: "Он прыгнул с падающего воздушного шара. Спичка была жребием — кому прыгать, чтобы спасти остальных." },
    { q: "Мужчина живет на 10 этаже. Вечером едет до 7-го, а дальше пешком. В дождь едет до 10-го.", a: "Он карлик. Достает только до кнопки 7, а в дождь нажимает на 10-ку кончиком зонта." },
    { q: "Женщина купила новые туфли и умерла в тот же вечер.", a: "Она — ассистентка метателя ножей. Новые каблуки сделали её выше, и нож попал в неё." },
    { q: "Мужчина выключил свет и лег спать. Утром он закричал и покончил с собой.", a: "Он смотритель маяка. Из-за него ночью разбились корабли." },
    { q: "Водитель грузовика едет против движения. Полиция видит его, но не останавливает.", a: "Водитель идет пешком по тротуару." },
    { q: "Человек лежит мертвый в поле. Рядом с ним нераскрытый пакет.", a: "Это парашютист, у которого не раскрылся парашют." },
    { q: "В комнате лежат двое мертвых. Вокруг осколки стекла и вода. Дверь заперта.", a: "Это были рыбки, их аквариум разбился." },
    { q: "Человек съел в ресторане мясо альбатроса, вышел и застрелился.", a: "Раньше он был в крушении. Ему сказали, что его кормили альбатросом, но на самом деле это был его погибший товарищ. Попробовав настоящего альбатроса, он все понял." },

    // --- Новое пополнение: Трагедии и Драмы ---
    { q: "В лесу найден мертвый мужчина в ластах и маске. До ближайшей воды 50 км.", a: "Пожарный самолет зачерпнул его из озера во время тушения лесного пожара." },
    { q: "Слепой попробовал мясо чайки в ресторане и покончил с собой.", a: "На необитаемом острове друг кормил его 'чайкой', чтобы тот не умер. Попробовав настоящую, он понял, что ел своего погибшего сына." },
    { q: "Человек бежит по коридору. Свет гаснет. Он понимает, что он труп.", a: "Это смертник. Свет погас — значит, включили электрический стул." },
    { q: "Мужчина видит свет в окне, пугается и убегает.", a: "Он вор. Свет в окне означает, что хозяева дома." },
    { q: "Женщина видит черную кошку на мосту, разворачивается и уходит. Это спасает ей жизнь.", a: "Она суеверна. Пока она обходила кошку другим путем, старый мост обрушился." },
    { q: "В комнате на столе лежат карты. Рядом — труп. В комнате никого нет.", a: "Это подводная лодка. Кислород кончался, они разыграли в карты последнюю пулю, чтобы один ушел быстро." },
    { q: "Человек наступил на лед в комнате и умер.", a: "Он встал на глыбу льда, чтобы накинуть петлю. Лед растаял, осталась только лужа." },
    { q: "Мужчина чистит яблоко ножом, съедает кусочек и падает замертво.", a: "Нож был смазан ядом только с одной стороны. Он предложил яблоко врагу, а сам съел отравленную часть." },
    { q: "На полу лежит мертвый мужчина в телефонной будке. Стекла разбиты.", a: "Он рыбак. Показывал руками, какую рыбу поймал, и случайно разбил стекла, порезав вены." },
    { q: "Женщина открывает посылку, видит отрезанную руку, улыбается и выбрасывает её.", a: "Она и её друзья — врачи-хирурги. Они договорились ампутировать себе руки в знак солидарности, но она всех обманула и прислала чужую руку из морга." },

    // --- Загадки на логику и хитрость ---
    { q: "Король приказал казнить узника, но разрешил сказать последнее утверждение. Если оно правда — повесят, если ложь — расстреляют. Узник выжил.", a: "Он сказал: 'Меня расстреляют'." },
    { q: "Двое едят одинаковый суп. Один выжил, другой умер.", a: "Яд был в кубиках льда. Один ел быстро, пока лед не растаял, другой медленно." },
    { q: "Человек проснулся ночью, включил свет, выключил его и лег спать. Утром погибло 100 человек.", a: "Это был смотритель маяка. Он выключил основной сигнал маяка." },
    { q: "Мужчина покупает жене подарок. Она его ненавидит, хотя он стоит миллионы.", a: "Он купил ей место на кладбище." },
    { q: "Мальчик выключил свет в спальне и успел лечь в кровать до того, как стало темно. Выключатель в 5 метрах.", a: "Он лег спать днем." },
    { q: "Два человека зашли в пещеру. Один смотрел на север, другой на юг. Но они видели друг друга.", a: "Они стояли лицом друг к другу." },
    { q: "Труп в поле, рядом рюкзак. Если бы рюкзак открылся, человек был бы жив.", a: "Это парашют." },
    { q: "Человек зашел в комнату, нажал на кнопку и умер.", a: "Он был в газовой камере и нажал на кнопку звонка, которая высекла искру." },
    { q: "Мужчина заходит в церковь, крестится, выходит и выигрывает в лотерею.", a: "Нет связи. Это просто совпадение (данетка с подвохом)." },
    { q: "Всадник скачет по пустыне. Конь умирает. Всадник идет пешком, находит отель, но не входит.", a: "Это игра в 'Монополию'. Фишка всадника попала на чужую собственность." },

    // --- Мрачные и странные ---
    { q: "Человек смотрит телевизор. Раздается выстрел. Он продолжает смотреть.", a: "Он глухой, а выстрел был в фильме. Или он уже был мертв." },
    { q: "Женщина заходит в лифт. На 5 этаже заходит мужчина с собакой. Она кричит и падает в обморок.", a: "Она — слепая, а мужчина — убийца, о котором предупреждали по радио (собака-поводырь его узнала)." },
    { q: "Человек стоит на рельсах. Поезд едет прямо на него, но он не двигается и остается жив.", a: "Поезд едет по параллельным путям." },
    { q: "Мужчина выпрыгнул из окна 20-этажного дома и не получил ни царапины.", a: "Он прыгнул из окна первого этажа." },
    { q: "Трое мужчин в одной лодке. Лодка перевернулась, но только двое намочили волосы.", a: "Третий был лысым." },
    { q: "Билл и Бен в одной комнате. На полу вода и битое стекло. Бен мертв.", a: "Бен — золотая рыбка, Билл — кот, который разбил аквариум." },
    { q: "Отец и сын попали в аварию. Отец погиб. Сына привезли в больницу, хирург говорит: 'Я не могу его оперировать, это мой сын!'.", a: "Хирург — его мать." },
    { q: "Человек нашел сокровище, но не смог его забрать из-за маленького отверстия. Он не стал его расширять и ушел богатым.", a: "Это был чек на огромную сумму, просунутый под дверь." },
    { q: "Мужчина бреется несколько раз в день, но у него все равно борода.", a: "Он парикмахер и бреет других." },
    { q: "Женщина рожает двух детей в один миг, но они не близнецы.", a: "Это двое из тройни." },

    // --- Финальный хардкор ---
    { q: "В пустыне лежит человек, одетый во всё золото. Он мертв.", a: "Это был летчик. Чтобы не перегружать самолет золотом, он надел его на себя, но парашют не выдержал веса." },
    { q: "Мужчина слышит музыку и умирает.", a: "Он танцор на канате. Музыка была сигналом конца выступления, но она остановилась раньше времени из-за поломки, и он шагнул в пустоту." },
    { q: "В комнате висит человек. Под ним — лужа воды. Мебели нет.", a: "Он встал на лед, чтобы повеситься." },
    { q: "Человек зашел в лифт, нажал кнопку, лифт поехал вверх, человек понял, что его жена умерла.", a: "Она была в больнице на аппарате ИВЛ. Лифт поехал — значит, дали свет, а до этого его не было, и аппарат отключился." },
    { q: "Мужчина идет по улице, начинается дождь. У него нет зонта и шляпы, но ни один волос на голове не намок.", a: "Он абсолютно лысый." },
    { q: "В баре человек заказывает стакан сока. Бармен бьет его по лицу. Человек говорит 'спасибо'.", a: "У человека была икота." },
    { q: "Человек съел свой завтрак и понял, что скоро ослепнет.", a: "Он был на подводной лодке, и это был последний паек перед отключением систем." },
    { q: "Мертвая женщина лежит в лесу. Рядом 53 сообщника.", a: "Она была игроком в карты. 'Сообщники' — это колода карт (52 + джокер). Её убили за жульничество." },
    { q: "Мужчина не спал 10 дней, но чувствует себя бодро.", a: "Он спал по ночам." },
    { q: "Человек упал с 30-метровой лестницы и не пострадал.", a: "Он упал с нижней ступеньки." }
];

let state = {
    score: parseInt(localStorage.getItem('danetki_score')) || 0,
    used: JSON.parse(localStorage.getItem('danetki_used')) || [],
    currentIdx: -1
};

function updateStats() {
    document.getElementById('score-display').innerText = state.score;
    let rank = "НОВИЧОК";
    if (state.score >= 5) rank = "ДЕТЕКТИВ";
    if (state.score >= 15) rank = "ИНСПЕКТОР";
    if (state.score >= 30) rank = "ШЕРЛОК";
    
    document.getElementById('rank-display').innerText = rank;
    localStorage.setItem('danetki_score', state.score);
    localStorage.setItem('danetki_used', JSON.stringify(state.used));
}

function startGame() {
    // Если все загадки просмотрены - предлагаем сброс
    if (state.used.length >= DB.length) {
        if(confirm("Все дела в архиве изучены. Начать заново?")) {
            state.used = [];
            updateStats();
        } else return;
    }

    let idx;
    // Ищем загадку, которой еще не было
    do { 
        idx = Math.floor(Math.random() * DB.length); 
    } while (state.used.includes(idx));

    state.currentIdx = idx;
    document.getElementById('riddle-text').innerText = DB[idx].q;
    document.getElementById('solution-text').innerText = DB[idx].a;
    toScreen('game-screen');
}

function nextRiddle(isWin) {
    if (isWin) {
        state.score += 1;
        state.used.push(state.currentIdx);
        if (window.navigator.vibrate) window.navigator.vibrate(50);
    }
    updateStats();
    toScreen('setup-screen');
}

function toggleRules(s) { document.getElementById('rules-modal').classList.toggle('active', s); }

function toScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}

// Инициализация при загрузке
updateStats();
