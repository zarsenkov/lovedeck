<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoveDeck Online üíå - –ò–≥—Ä–∞ –Ω–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏</title>
    <link rel="stylesheet" href="online.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="online-container">
        <!-- –®–∞–ø–∫–∞ -->
        <header class="online-header">
            <h1>üíå LoveDeck Online</h1>
            <p class="subtitle">–ò–≥—Ä–∞ –≤ –ª—é–±–æ–≤—å –Ω–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏</p>
        </header>
        
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π —ç–∫—Ä–∞–Ω –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è -->
        <main class="online-main">
            <div class="connection-screen" id="connection-screen">
                <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–æ–≤ –¥–æ–±–∞–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                
                <div class="player-card create-room">
                    <h2>üëë –°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</h2>
                    <p>–í—ã –±—É–¥–µ—Ç–µ –≤–µ–¥—É—â–∏–º –∏–≥—Ä—ã</p>
                    <input type="text" id="player1-name" placeholder="–í–∞—à–µ –∏–º—è" value="–ò–≥—Ä–æ–∫ 1">
                    
                    <div class="quick-start" style="margin-bottom: 15px;">
                        <button class="btn-quick-start">
                            ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
                        </button>
                        <p class="quick-start-hint">
                            –°–æ–∑–¥–∞—Å—Ç –∫–æ–º–Ω–∞—Ç—É –∏ –ø–æ–∫–∞–∂–µ—Ç QR-–∫–æ–¥ –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
                        </p>
                    </div>
                    
                    <button class="btn-primary">–°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É</button>
                </div>
                
                <div class="divider">
                    <span>–∏–ª–∏</span>
                </div>
                
                <div class="player-card join-room">
                    <h2>üéÆ –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</h2>
                    <p>–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ø–∞—Ä—Ç–Ω–µ—Ä—É</p>
                    <input type="text" id="player2-name" placeholder="–í–∞—à–µ –∏–º—è" value="–ò–≥—Ä–æ–∫ 2">
                    <input type="text" id="room-code" placeholder="–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã">
                    <button class="btn-secondary">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
                </div>
            </div>
            
            <!-- –≠–∫—Ä–∞–Ω –∫–æ–º–Ω–∞—Ç—ã -->
            <div class="room-screen" id="room-screen" style="display: none;">
                <div class="room-info">
                    <h2>–ö–æ–º–Ω–∞—Ç–∞: <span id="room-id-display">---</span></h2>
                    <div class="players">
                        <div class="player" id="player1">
                            <div class="player-avatar">üë§</div>
                            <span class="player-name">–û–∂–∏–¥–∞–Ω–∏–µ...</span>
                            <div class="player-status" id="status1">‚ùå</div>
                        </div>
                        <div class="player" id="player2">
                            <div class="player-avatar">üë§</div>
                            <span class="player-name">–û–∂–∏–¥–∞–Ω–∏–µ...</span>
                            <div class="player-status" id="status2">‚ùå</div>
                        </div>
                    </div>
                    
                    <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º -->
                    <div class="connection-controls" style="margin: 20px 0; padding: 15px; background: #f9f0ff; border-radius: 10px; border: 2px solid #e1bee7;">
                        <h4 style="color: #9C27B0; margin-bottom: 10px; text-align: center;">üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞–º–∏</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">
                            <button class="btn-ready">
                                ‚úÖ –Ø –≥–æ—Ç–æ–≤(–∞) –∫ –∏–≥—Ä–µ
                            </button>
                            <button class="btn-partner">
                                üëã –ü–∞—Ä—Ç–Ω–µ—Ä –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è
                            </button>
                            <button class="btn-force-start">
                                üöÄ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –Ω–∞—á–∞—Ç—å
                            </button>
                        </div>
                        <p style="color: #666; font-size: 12px; text-align: center; margin-top: 10px;">
                            –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–∏ –∫–Ω–æ–ø–∫–∏, —á—Ç–æ–±—ã —É–ø—Ä–∞–≤–ª—è—Ç—å —Å—Ç–∞—Ç—É—Å–æ–º –∏–≥—Ä–æ–∫–æ–≤
                        </p>
                    </div>
                    
                    <div class="room-actions">
                        <button class="btn-copy">
                            üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
                        </button>
                        <button class="btn-qr">
                            üì± –ü–æ–∫–∞–∑–∞—Ç—å QR-–∫–æ–¥
                        </button>
                        <button class="btn-start" id="start-game-btn" disabled>
                            –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
                        </button>
                    </div>
                    
                    <div class="chat-box">
                        <h3>üí¨ –ß–∞—Ç —Å –ø–∞—Ä—Ç–Ω–µ—Ä–æ–º</h3>
                        
                        <!-- –ö–ù–û–ü–ö–ò –î–õ–Ø –û–¢–ü–†–ê–í–ö–ò –ö–ê–†–¢–û–ß–ï–ö -->
                        <div class="card-buttons" id="card-buttons" style="display: none;">
                            <h4 style="margin: 15px 0 10px 0; color: #e91e63;">üé¥ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É</h4>
                            <div class="quick-cards">
                                <button class="card-btn card-question">
                                    üí¨ –°–ª—É—á–∞–π–Ω—ã–π –≤–æ–ø—Ä–æ—Å
                                </button>
                                <button class="card-btn card-action">
                                    üî• –°–ª—É—á–∞–π–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ
                                </button>
                                <button class="card-btn card-date">
                                    üåπ –°–ª—É—á–∞–π–Ω–æ–µ —Å–≤–∏–¥–∞–Ω–∏–µ
                                </button>
                                <button class="card-btn card-compliment">
                                    üíñ –°–ª—É—á–∞–π–Ω—ã–π –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç
                                </button>
                            </div>
                        </div>
                        
                        <div class="chat-messages" id="chat-messages"></div>
                        
                        <div class="chat-input">
                            <input type="text" id="chat-input" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ...">
                            <button class="chat-send">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                        </div>
                    </div>
                </div>
                
                <!-- QR –∫–æ–¥ –º–æ–¥–∞–ª–∫–∞ -->
                <div class="modal" id="qr-modal" style="display: none;">
                    <div class="modal-content">
                        <h3>üì± –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –ø–æ QR-–∫–æ–¥—É</h3>
                        <div id="qr-code"></div>
                        <p>–ü–∞—Ä—Ç–Ω–µ—Ä –º–æ–∂–µ—Ç –æ—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –∫–æ–¥</p>
                        <button class="btn-close">–ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- –ü–æ–¥–≤–∞–ª -->
        <footer class="online-footer">
            <p>–ü—Ä–æ—Å—Ç–æ –ø–æ–¥–µ–ª–∏—Å—å –∫–æ–¥–æ–º –∫–æ–º–Ω–∞—Ç—ã —Å –ø–∞—Ä—Ç–Ω–µ—Ä–æ–º üíñ</p>
            <a href="index.html" class="btn-back">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ª–æ–∫–∞–ª—å–Ω–æ–π –∏–≥—Ä–µ</a>
        </footer>
    </div>

    <!-- Firebase –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <!-- –ù–∞—à–∏ —Å–∫—Ä–∏–ø—Ç—ã (–í–ê–ñ–ï–ù –ü–û–†–Ø–î–û–ö!) -->
    <script src="online-simple.js"></script>            <!-- 1. –õ–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π) -->
    <script src="firebase-mode.js"></script>           <!-- 2. Firebase —Ä–µ–∂–∏–º -->
    
    <!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–Ω–æ–ø–æ–∫ -->
    <script>
        // –¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º
        let currentMode = 'local';
        
        // –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
        window.addEventListener('load', function() {
            console.log('üì¶ –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–æ–≤
            addModeSelector();
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º)
            setupLocalMode();
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Ä–µ–∂–∏–º–∞
            setupCommonHandlers();
        });
        
        // –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–æ–≤
        function addModeSelector() {
            const connectionScreen = document.getElementById('connection-screen');
            if (!connectionScreen) return;
            
            const selectorHTML = `
                <div class="mode-selector">
                    <h3>üåê –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –∏–≥—Ä—ã:</h3>
                    <div class="mode-buttons">
                        <button class="mode-btn" id="firebase-mode-btn">
                            üî• –û–Ω–ª–∞–π–Ω (Firebase)
                            <small>–ú–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏</small>
                        </button>
                        <button class="mode-btn active" id="local-mode-btn">
                            üíª –õ–æ–∫–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç
                            <small>–ù–∞ –æ–¥–Ω–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ</small>
                        </button>
                    </div>
                    <p class="mode-info" id="mode-info">
                        üíª <strong>–õ–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º</strong>: –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –æ–¥–Ω–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ. –û—Ç–∫—Ä–æ–π—Ç–µ –¥–≤–µ –≤–∫–ª–∞–¥–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞.
                    </p>
                </div>
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏
            const style = document.createElement('style');
            style.textContent = `
                .mode-selector {
                    background: white;
                    border-radius: 15px;
                    padding: 20px;
                    margin-bottom: 25px;
                    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
                    border: 2px solid #e0e0e0;
                }
                .mode-selector h3 {
                    color: #673ab7;
                    margin: 0 0 15px 0;
                    text-align: center;
                    font-size: 20px;
                }
                .mode-buttons {
                    display: flex;
                    gap: 15px;
                    margin-bottom: 15px;
                }
                @media (max-width: 600px) {
                    .mode-buttons {
                        flex-direction: column;
                    }
                }
                .mode-btn {
                    flex: 1;
                    padding: 15px;
                    border: none;
                    border-radius: 10px;
                    background: #f5f5f5;
                    color: #666;
                    cursor: pointer;
                    font-weight: bold;
                    transition: all 0.3s;
                }
                .mode-btn:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
                }
                .mode-btn.active {
                    background: linear-gradient(45deg, #9C27B0, #E91E63);
                    color: white;
                    transform: translateY(-2px);
                    box-shadow: 0 5px 15px rgba(156, 39, 176, 0.3);
                }
                .mode-btn small {
                    display: block;
                    font-size: 12px;
                    margin-top: 5px;
                    opacity: 0.8;
                }
                .mode-info {
                    color: #666;
                    font-size: 14px;
                    padding: 10px;
                    background: #f9f9f9;
                    border-radius: 8px;
                    text-align: center;
                    margin: 0;
                }
                #firebase-mode-btn.active {
                    background: linear-gradient(45deg, #FF9800, #FFB74D);
                    box-shadow: 0 5px 15px rgba(255, 152, 0, 0.3);
                }
            `;
            document.head.appendChild(style);
            
            // –í—Å—Ç–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å
            connectionScreen.insertAdjacentHTML('afterbegin', selectorHTML);
            
            // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
            document.getElementById('firebase-mode-btn').addEventListener('click', switchToFirebaseMode);
            document.getElementById('local-mode-btn').addEventListener('click', switchToLocalMode);
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ Firebase —Ä–µ–∂–∏–º
        function switchToFirebaseMode() {
            currentMode = 'firebase';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
            document.getElementById('firebase-mode-btn').classList.add('active');
            document.getElementById('local-mode-btn').classList.remove('active');
            document.getElementById('mode-info').innerHTML = 
                'üî• <strong>–û–Ω–ª–∞–π–Ω —Ä–µ–∂–∏–º (Firebase)</strong>: –¥–ª—è –∏–≥—Ä—ã –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏. –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–º–Ω–∞—Ç—É –∏ –ø–æ–¥–µ–ª–∏—Ç–µ—Å—å –∫–æ–¥–æ–º.';
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è Firebase —Ä–µ–∂–∏–º–∞
            setupFirebaseMode();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            showNotification('–í—ã–±—Ä–∞–Ω –æ–Ω–ª–∞–π–Ω —Ä–µ–∂–∏–º! –°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∫–æ–º–Ω–∞—Ç—ã –¥–ª—è –∏–≥—Ä—ã –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö.', 'success');
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º
        function switchToLocalMode() {
            currentMode = 'local';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
            document.getElementById('local-mode-btn').classList.add('active');
            document.getElementById('firebase-mode-btn').classList.remove('active');
            document.getElementById('mode-info').innerHTML = 
                'üíª <strong>–õ–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º</strong>: –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –æ–¥–Ω–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ. –û—Ç–∫—Ä–æ–π—Ç–µ –¥–≤–µ –≤–∫–ª–∞–¥–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞.';
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
            setupLocalMode();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            showNotification('–í—ã–±—Ä–∞–Ω –ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º! –û—Ç–∫—Ä–æ–π—Ç–µ –¥–≤–µ –≤–∫–ª–∞–¥–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.', 'info');
        }
        
        // –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º
        function setupLocalMode() {
            // –ö–Ω–æ–ø–∫–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
            const createBtn = document.querySelector('.player-card.create-room .btn-primary');
            const joinBtn = document.querySelector('.player-card.join-room .btn-secondary');
            const quickBtn = document.querySelector('.btn-quick-start');
            
            if (createBtn) {
                createBtn.textContent = 'üíª –°–æ–∑–¥–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é –∫–æ–º–Ω–∞—Ç—É';
                createBtn.onclick = window.createRoom;
            }
            
            if (joinBtn) {
                joinBtn.textContent = 'üíª –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ';
                joinBtn.onclick = window.joinRoom;
            }
            
            if (quickBtn && window.quickStartGame) {
                quickBtn.onclick = window.quickStartGame;
            } else if (quickBtn && window.createRoom) {
                quickBtn.onclick = window.createRoom;
            }
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –≤ –∫–æ–º–Ω–∞—Ç–µ (–µ—Å–ª–∏ –æ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∞)
            setupRoomButtonsForLocal();
        }
        
        // –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Firebase —Ä–µ–∂–∏–º
        function setupFirebaseMode() {
            // –ö–Ω–æ–ø–∫–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
            const createBtn = document.querySelector('.player-card.create-room .btn-primary');
            const joinBtn = document.querySelector('.player-card.join-room .btn-secondary');
            const quickBtn = document.querySelector('.btn-quick-start');
            
            if (createBtn && window.firebaseCreateRoom) {
                createBtn.textContent = 'üî• –°–æ–∑–¥–∞—Ç—å –æ–Ω–ª–∞–π–Ω-–∫–æ–º–Ω–∞—Ç—É';
                createBtn.onclick = window.firebaseCreateRoom;
            }
            
            if (joinBtn && window.firebaseJoinRoom) {
                joinBtn.textContent = 'üî• –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –æ–Ω–ª–∞–π–Ω';
                joinBtn.onclick = window.firebaseJoinRoom;
            }
            
            if (quickBtn && window.firebaseCreateRoom) {
                quickBtn.textContent = '‚ö° –ë—ã—Å—Ç—Ä—ã–π –æ–Ω–ª–∞–π–Ω-—Å—Ç–∞—Ä—Ç';
                quickBtn.onclick = window.firebaseCreateRoom;
            }
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –≤ –∫–æ–º–Ω–∞—Ç–µ (–µ—Å–ª–∏ –æ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∞)
            setupRoomButtonsForFirebase();
        }
        
        // –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–Ω–æ–ø–∫–∏ –≤ –∫–æ–º–Ω–∞—Ç–µ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
        function setupRoomButtonsForLocal() {
            const roomScreen = document.getElementById('room-screen');
            if (!roomScreen || roomScreen.style.display === 'none') return;
            
            // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            const readyBtn = document.querySelector('.btn-ready');
            const partnerBtn = document.querySelector('.btn-partner');
            const forceBtn = document.querySelector('.btn-force-start');
            const startBtn = document.getElementById('start-game-btn');
            
            if (readyBtn && window.markSelfReady) readyBtn.onclick = window.markSelfReady;
            if (partnerBtn && window.confirmPartnerConnection) partnerBtn.onclick = window.confirmPartnerConnection;
            if (forceBtn && window.forceStartGame) forceBtn.onclick = window.forceStartGame;
            if (startBtn && window.startGame) startBtn.onclick = window.startGame;
            
            // –ö–Ω–æ–ø–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫
            setupCardButtonsForLocal();
            
            // –ö–Ω–æ–ø–∫–∞ —á–∞—Ç–∞
            const chatBtn = document.querySelector('.chat-send');
            if (chatBtn && window.sendChatMessage) {
                chatBtn.onclick = window.sendChatMessage;
            }
        }
        
        // –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–Ω–æ–ø–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
        function setupCardButtonsForLocal() {
            const questionBtn = document.querySelector('.card-question');
            const actionBtn = document.querySelector('.card-action');
            const dateBtn = document.querySelector('.card-date');
            const complimentBtn = document.querySelector('.card-compliment');
            
            if (questionBtn && window.sendRandomQuestion) questionBtn.onclick = window.sendRandomQuestion;
            if (actionBtn && window.sendRandomAction) actionBtn.onclick = window.sendRandomAction;
            if (dateBtn && window.sendRandomDate) dateBtn.onclick = window.sendRandomDate;
            if (complimentBtn && window.sendRandomCompliment) complimentBtn.onclick = window.sendRandomCompliment;
        }
        
        // –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–Ω–æ–ø–∫–∏ –≤ –∫–æ–º–Ω–∞—Ç–µ –¥–ª—è Firebase
        function setupRoomButtonsForFirebase() {
            const roomScreen = document.getElementById('room-screen');
            if (!roomScreen || roomScreen.style.display === 'none') return;
            
            // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            const readyBtn = document.querySelector('.btn-ready');
            const partnerBtn = document.querySelector('.btn-partner');
            const forceBtn = document.querySelector('.btn-force-start');
            const startBtn = document.getElementById('start-game-btn');
            
            if (readyBtn && window.firebaseMarkSelfReady) readyBtn.onclick = window.firebaseMarkSelfReady;
            if (partnerBtn && window.firebaseConfirmPartner) partnerBtn.onclick = window.firebaseConfirmPartner;
            if (forceBtn && window.firebaseForceStart) forceBtn.onclick = window.firebaseForceStart;
            if (startBtn && window.firebaseMarkSelfReady) startBtn.onclick = window.firebaseMarkSelfReady;
            
            // –ö–Ω–æ–ø–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫
            setupCardButtonsForFirebase();
            
            // –ö–Ω–æ–ø–∫–∞ —á–∞—Ç–∞
            const chatBtn = document.querySelector('.chat-send');
            if (chatBtn && window.firebaseSendChatMessage) {
                chatBtn.onclick = window.firebaseSendChatMessage;
            }
        }
        
        // –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–Ω–æ–ø–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è Firebase
        function setupCardButtonsForFirebase() {
            const questionBtn = document.querySelector('.card-question');
            const actionBtn = document.querySelector('.card-action');
            const dateBtn = document.querySelector('.card-date');
            const complimentBtn = document.querySelector('.card-compliment');
            
            if (questionBtn && window.firebaseSendRandomQuestion) questionBtn.onclick = window.firebaseSendRandomQuestion;
            if (actionBtn && window.firebaseSendRandomAction) actionBtn.onclick = window.firebaseSendRandomAction;
            if (dateBtn && window.firebaseSendRandomDate) dateBtn.onclick = window.firebaseSendRandomDate;
            if (complimentBtn && window.firebaseSendRandomCompliment) complimentBtn.onclick = window.firebaseSendRandomCompliment;
        }
        
        // –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–±—â–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (–Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Ä–µ–∂–∏–º–∞)
        function setupCommonHandlers() {
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ Enter –¥–ª—è —á–∞—Ç–∞
            const chatInput = document.getElementById('chat-input');
            if (chatInput) {
                chatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        if (currentMode === 'firebase' && window.firebaseSendChatMessage) {
                            window.firebaseSendChatMessage();
                        } else if (window.sendChatMessage) {
                            window.sendChatMessage();
                        }
                    }
                });
            }
            
            // –ö–Ω–æ–ø–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ –∫–æ–º–Ω–∞—Ç—ã
            const copyBtn = document.querySelector('.btn-copy');
            if (copyBtn) {
                copyBtn.onclick = function() {
                    const roomCode = document.getElementById('room-id-display').textContent;
                    if (roomCode && roomCode !== '---') {
                        navigator.clipboard.writeText(roomCode).then(() => {
                            showNotification('–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!', 'success');
                        }).catch(() => {
                            showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥', 'error');
                        });
                    }
                };
            }
            
            // –ö–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑–∞ QR-–∫–æ–¥–∞
            const qrBtn = document.querySelector('.btn-qr');
            if (qrBtn) {
                qrBtn.onclick = function() {
                    const roomCode = document.getElementById('room-id-display').textContent;
                    if (roomCode && roomCode !== '---') {
                        showQRCode(roomCode);
                    }
                };
            }
            
            // –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è QR-–∫–æ–¥–∞
            const closeQrBtn = document.querySelector('.btn-close');
            if (closeQrBtn) {
                closeQrBtn.onclick = function() {
                    document.getElementById('qr-modal').style.display = 'none';
                };
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å QR-–∫–æ–¥
        function showQRCode(roomCode) {
            const qrModal = document.getElementById('qr-modal');
            const qrCodeDiv = document.getElementById('qr-code');
            
            const qrUrl = `https://chart.googleapis.com/chart?cht=qr&chs=300x300&chl=${encodeURIComponent(roomCode)}&choe=UTF-8`;
            
            qrCodeDiv.innerHTML = `<img src="${qrUrl}" alt="QR Code" style="border-radius:10px; padding:10px; background:white;">`;
            qrModal.style.display = 'flex';
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: ${type === 'error' ? '#f44336' : type === 'success' ? '#4CAF50' : '#2196F3'};
                color: white;
                padding: 12px 24px;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                z-index: 10003;
                animation: slideDown 0.3s ease;
                display: flex;
                align-items: center;
                gap: 10px;
            `;
            
            notification.innerHTML = `
                ${type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è'}
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideUp 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
    </script>
</body>
</html>
